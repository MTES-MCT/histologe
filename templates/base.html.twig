{% set container_class = 'fr-container' %}
{% if 'back_' in app.request.get('_route') and app.user is not null %}
    {% set container_class = 'fr-container-sml' %}
{% endif %}

<!DOCTYPE html>
<html lang="fr" {{ mise_en_berne ? 'data-fr-mourning' : '' }}>
<head>
    <meta charset="UTF-8">
    {% if 'back_' in app.request.get('_route') or 'front_suivi_signalement' in app.request.get('_route') %}
        <meta name="robots" content="noindex, nofollow">
    {% else %}
        <meta name="robots" content="index, follow">
    {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}{% endblock %} - {{ platform.name|replace({' ': '-'}) }}</title>
    <meta name="description" content="Signaler vos problèmes de logement.">
    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="{{ platform.url }}">
    <meta property="og:type" content="website">
    <meta property="og:title" content="{{ platform.name }}">
    <meta property="og:description" content="Signaler vos problèmes de logement.">
    <meta property="og:image" content={{ asset('img/' ~ (platform.logo ?: 'logo-signal-logement.svg')) }}>
    <meta property="og:site_name" content="{{ platform.name }}">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="{{ platform.url }}">
    <meta property="twitter:url" content="{{ platform.url }}">
    <meta name="twitter:title" content="{{ platform.name }}">
    <meta name="twitter:description" content="Signalez vos problèmes de logement.">
    <meta name="twitter:image" content={{ asset('img/' ~ (platform.logo ?: 'logo-signal-logement.svg')) }}>
    <meta name="twitter:title" content="{{ platform.name }}">
    <meta name="twitter:description" content="Signalez vos problèmes de logement.">
    <meta name="apple-mobile-web-app-title" content="{{ platform.name }}">
    <link rel="icon" href={{ asset('favicon.ico') }}>
    <link rel="stylesheet" href="{{ asset('build/dsfr/dsfr.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-arrows/icons-arrows.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-buildings/icons-buildings.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-business/icons-business.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-communication/icons-communication.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-others/icons-others.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-device/icons-device.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-design/icons-design.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-document/icons-document.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-editor/icons-editor.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-map/icons-map.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-media/icons-media.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-system/icons-system.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-user/icons-user.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-weather/icons-weather.min.css') }}">
    <link rel="stylesheet" href="{{ asset('build/dsfr/utility/icons/icons-arrows/icons-arrows.min.css') }}">
    <link rel="stylesheet" href={{ asset('build/app.css') }}>

    {% if app.request.get('_route') == 'back_indicateur_pnlhi' %}
        <meta http-equiv="refresh" content="{{ refreshDelayInSeconds|default(3600) }}"> <!-- in seconds -->
    {% endif %}

    {% block stylesheets %}{% endblock %}
    {% block customscripts %}
        {{ encore_entry_script_tags('app') }}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}
    {% if matomo is defined and matomo.enable == 1 and 'activate_account' not in app.request.get('_route') %}
        <!-- Matomo -->
        <script nonce="{{ app.request.attributes.get('csp_script_nonce') }}">
            var _paq = window._paq = window._paq || [];
            {% if platform.url starts with 'https' %}
                _paq.push(['setSecureCookie', true]);
            {% endif %}
            /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
            {% if app.user is not null and ('ROLE_ADMIN_TERRITORY' in app.user.roles or 'ROLE_ADMIN_PARTNER' in app.user.roles or 'ROLE_USER_PARTNER' in app.user.roles) %}
                _paq.push(['setCustomDimension', customDimensionId = 1, customDimensionValue = '{{ app.user.roles|first}}' ]);
                _paq.push(['setCustomDimension', customDimensionId = 2, customDimensionValue = '{{ app.user.firstTerritory.name }}' ]);
                _paq.push(['setCustomDimension', customDimensionId = 3, customDimensionValue = '{{ app.user.partners.first.nom }}' ]);
                _paq.push(['requireConsent']);
            {% endif %}
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            (function() {
                var u="{{ matomo.url }}";
                _paq.push(['setTrackerUrl', u+'matomo.php']);
                _paq.push(['setSiteId', '{{ matomo.site_id }}']);
                var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                g.async=true; g.src='{{ matomo.cdn }}'; s.parentNode.insertBefore(g,s);
            })();
        </script>
        <!-- End Matomo Code -->
    {% endif %}
</head>

{% set statuses = {
    1:'Nouveau',
    2:'En cours',
    6:'Fermés',
    8:'Refusés'
} %}
{% set allocations = {
    'CAF':'CAF',
    'MSA':'MSA',
    0:'NON',
} %}
{% set statuts_affectation = {
    0:'EN ATTENTE',
    1:'ACCEPTEE',
    2:'REFUSEE',
    3:'CLOTUREE',
} %}
<body {% if bodyClass is defined %}class="{{ bodyClass }}"{% endif %}
      data-mode-maintenance="{{ maintenance.enable }}">
{% include "skiplink.html.twig" %}
{% include 'maintenance/banner.html.twig' %}
{% if 'back_' not in app.request.get('_route') %}
    {% include "header.html.twig" %}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div role="alert" class="fr-alert fr-alert--{{ label }} fr-alert--sm">
                {% if label is same as('error') or label is same as('error error-raw')  %}
                    <strong>Erreur...</strong>
                {% endif %}
                {% if label is same as('error error-raw')  %}
                    <p>{{ message|raw }}</p>
                {% else %}
                    <p>{{ message }}</p>
                {% endif %}
            </div>
        {% endfor %}
    {% endfor %}
{% else %}
    {% include "consent_banner/banner.html.twig" %}
{% endif %}

{% block body %}{% endblock %}
{% if 'back_cartographie' not in app.request.get('_route') %}
    {% include "footer.html.twig" %}
{% endif %}

<script type="module" src="{{ asset('build/dsfr/dsfr.module.min.js') }}"></script>
<script nomodule src="{{ asset('build/dsfr/dsfr.nomodule.min.js') }}"></script>

{% if 'back_signalement_view' in app.request.get('_route') %}
    <script src="{{ asset('build/popper/umd/popper.min.js') }}"></script>
    <script src="{{ asset('build/tinymce/tinymce.min.js') }}"></script>
{% endif %}

{% block javascripts %}{% endblock %}
{% block documentation %}{% endblock %}
{% block bo_modales %}{% endblock %}
</body>
</html>
