<dialog aria-labelledby="cloture-modal-title" id="cloture-modal" class="fr-modal">
    <div class="fr-container fr-container--fluid fr-container-md">
        <div class="fr-grid-row fr-grid-row--center">
            <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
                <div class="fr-modal__body">
                    <div class="fr-modal__header">
                        <button type="button" class="fr-btn--close fr-btn" aria-controls="cloture-modal">Fermer</button>
                    </div>
                    <div class="fr-modal__content">
                        <h1 id="cloture-modal-title" class="fr-modal__title">Clôture signalement #{{ signalement.reference }}</h1>

                        {{ form_start(clotureForm, {'attr': {'id': 'cloture_form', 'data-submit-type':'formData'}}) }}
                        {{ form_errors(clotureForm) }}
                        {{ form_row(clotureForm.motifCloture) }}
                        {{ form_row(clotureForm.type) }}
                        {{ form_row(clotureForm.description) }}
                        {{ form_row(clotureForm.files) }}
                        {% if is_granted('ROLE_ADMIN_TERRITORY') %}
                            {{ form_row(clotureForm.isPublic) }}
                        {% endif %}
                        {{ form_end(clotureForm) }}
                        
                        {% if is_granted('ROLE_ADMIN_TERRITORY') %}
                            <div id="warning_cloture_public_oui" class="fr-alert fr-alert--warning">
                                <h3 class="fr-alert__title">Attention</h3>
                                <p>Le motif et les détails de clôture seront également envoyés à l'usager.</p>
                            </div>
                            <div id="warning_cloture_public_non" class="fr-alert fr-alert--info fr-hidden">
                                <p>L'usager ne sera pas informé de la clôture de son signalement.</p>
                            </div>
                        {% endif %}
                    </div>
                    <div class="fr-modal__footer">
                        <ul class="fr-btns-group fr-btns-group--right fr-btns-group-reverse fr-btns-group--icon-left">
                            {% if is_granted('ROLE_ADMIN_TERRITORY') %}
                                <li>
                                    <button class="fr-btn fr-icon-check-line" form="cloture_form" type="submit" data-cloture-type="all">
                                        Clôturer pour tous les partenaires
                                    </button>
                                </li>
                                {% if affectation and affectation.statut is same as constant('App\\Entity\\Enum\\AffectationStatus::ACCEPTED') %}
                                    <li>
                                        <button class="fr-btn fr-icon-check-line" form="cloture_form" type="submit" data-cloture-type="partner">
                                            Clôturer pour {{ app.user.partnerInTerritoryOrFirstOne(signalement.territory) ? app.user.partnerInTerritoryOrFirstOne(signalement.territory).nom : 'N/A' }}
                                        </button>
                                    </li>
                                {% endif %}
                            {% else %}
                                <li>
                                    <button class="fr-btn fr-icon-check-line" form="cloture_form" data-cloture-type="partner" type="submit">
                                        Clôturer pour {{ app.user.partnerInTerritoryOrFirstOne(signalement.territory) ? app.user.partnerInTerritoryOrFirstOne(signalement.territory).nom : 'N/A' }}
                                    </button>
                                </li>
                            {% endif %}
                            <li>
                                <button class="fr-btn fr-btn--secondary fr-icon-close-line " aria-controls="cloture-modal" type="button">
                                    Annuler
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</dialog>
